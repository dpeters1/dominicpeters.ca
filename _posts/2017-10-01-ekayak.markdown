---
layout:     post
title:      "E-Kayak"
subtitle:   "An Eletrified Kayak for Commuting to School"
date:       2017-10-01 12:00:00
categories: projects
author:     "Dominic Peters"
header-img: "img/E-Kayak/bg.jpg"
use_math: true
---

## A new Beginning

Looking at previous posts, it could be assumed that this project is well and truly dead. However, one year later I have decided to take a second shot at building an e-kayak that actually works. 
While last year’s design serves as a proof of concept, it suffered from many shortcomings, mainly rooted to the fact that the suite of rc electronics used were woefully underpowered. It was pretty naive to think that I could push even 600-700 watts continuously at a supply voltage of 7.4V. Electronics are limited in their usable energy output by the amount of thermal, or waste energy that they can dissipate. Given some device with a fixed internal resistance, the voltage drop across it is proportional to the current flowing through it. The heat output, or power lost, is then given by $$P = v*i$$ or $$P = i^2/R$$. It’s important to realize that the overall voltage of the system has absolutely no bearing on the voltage drop across components, so long as the current stays the same. For this reason, the easiest way to make a system more efficient is to increase the voltage and decrease the current. The overall output power stays the same, but doubling the voltage and halving the current will result in ¼ of the heat. Europeans obviously figured this out when they chose to make 240V the standard household voltage, rather than 120V in North America.

With this in mind, here are the new electronics to power the kayak:
* YEP 120A High Voltage ESC
* Turnigy 6374 168kv Brushless Motor
* 6x 4S 14.8V 5.2Ah Multistart Lipo Batteries

The batteries are wired in 3S2P configuration, giving me 12 cells for a peak voltage of 50.4V and capacity of 10.4Ah or around 500Wh. 500Wh is equivalent to about 70 iPhone 7 batteries, but only 0.5% of a Tesla P100D battery pack. If anything this makes you realize just how massive the batteries in Tesla cars are.

The YEP ESC from Hobbyking was chosen because it’s a shameless clone of the more expensive, German designed YGE ESCs. The open source VESC was also a serious consideration due to it’s telemetry and multiple control options (i2c, canbus, ppm) but in the end the YEP ESC has beefier mosfets and is rated at higher current. 120 amps continuous is overkill, but since I’m using it in a waterproof enclosure I don’t want to run into issues with thermals, so some margin is good. 

The Turnigy 6374 motor is the weakest link in this group, being rated at 2400W and 80A peak. Nonetheless, it’s a popular choice for DIY electric bikes and skateboards, so we’ll see how it performs in the kayak. It’ll be important to find a good gear ratio to match the prop and get the maximum performance. In the next post I’ll talk a bit about basic brushless motor theory and how it applies to this build.

## Brushless Motor Theory

Brushless motors have always seemed very complicated to me, but after a bit of research I think I understand the basics. The type of brushless motors used in remote control vehicles and most applications below a few kW have a permanent magnet in the rotor which interacts with the electrical field generated by 3-phase AC electricity in the stator. The windings are placed 120* apart, and fire in clockwise or counterclockwise sequence. When the electrical field is created in the stator, it causes the magnet in the rotor to align with it. Unlike an induction motor, which requires some degree of slip between the rotor and stator to generate torque, permanent magnet brushless motors don’t slip at all (unless they torque stall). This means that one can precisely control the motor rpm by controlling the frequency of the AC current. For example, if you were to plug such a motor into a household socket with a frequency of 60Hz, the motor would spin at exactly 60 cycles per second or 3600 rpm. Many utility motors function like this, requiring a change in gearing to change the output rpm. 

This fixed-rpm operation is obviously impractical for any vehicles. Instead, an electronic speed control is used as the middle-man between the battery and the motor. Essentially, all an ESC is, is a variable frequency inverter, which inverts the DC from the batteries into 3-phase AC for the motor. So if motor rpm is simply controlled by frequency, what does voltage control? This is where my understanding drops off a little, but I’ll try to explain.

Whenever the rotor turns, there is some resistive force. This force is the torque on the motor. Even when the motor isn’t connected to anything, the friction in the bearings created some force that opposes the motion of the rotor. The current drawn is simply a function of applied torque and magnet strength. Since the strength of the magnet cannot be changed after manufacturing, this means that motor torque is the only variable controlling the magnitude of current. However, unlike brushed motors which are fed by DC, synchronous motors are fed by AC and therefore voltage and current are both sine wave functions. The phase angle between these two determines the real and imaginary components of current, representing useful torque and magnetic flux respectively. Let’s look at some phasor diagrams:
![]({{ site.url }}/img/E-Kayak/phasors.jpg)
###### Hughes, A. and Drury, B. (2013). ELECTRIC MOTORS AND DRIVES: Fundamentals, Types, and Applications. 4th ed. Oxford: Elsevier, p.289.

The equivalent voltage equation for a motor is $V = IR + IX + E$, but we can drop IR for simplicity, leaving us with $V = IX + E$, where IX is the voltage drop due to the inductance of the windings, and E is the back EMF generated by the spinning magnet rotor. Two important considerations: 
* Due to the inductive nature of the windings, voltage IX always leads current I by 90*
* E is proportional to magnet strength and rotor speed

As you can see in the phasor diagram, input voltage is equal to the vector sum of IX and E. If E is smaller or larger than V, the direction and magnitude of IX also changes. Recall that voltage IX leads the current by 90*, so any change in the direction of IX is reflected in the phase angle of current I. Figure (a) and (c) show the underexcited and overexcited cases respectively. In both of these cases, the current vector is composed of torque and magnetic flux components. The cosine of the angle between voltage and current is also known as the power factor and is a measure of motor efficiency. Figure (b) represents the ideal condition, where the real components of V and E are identical. The current is in phase and has only a useful torque component. The power factor is 1 and peak efficiency is achieved.

From this we can conclude to maintain peak efficiency, the input voltage must be set to match the back EMF. Since we’re dealing with a permanent magnet, the back EMF is a function of magnet strength and rotor speed, the latter which is set precisely by the supply frequency. So that explains how voltage and rpm are related. Not such that rpm is dependant on voltage, but that voltage is varied to give maximum useful torque at a given rpm.

Sidenote: I imagine that when Tesla talks about removing the battery heaters in the model 3 and just relying on using the motor to heat the batteries, they are manipulating the current vector so it generates heat instead of torque to the wheels.

Anyways, the opposing torque created by the prop is proportional to the speed at which it turns, so at steady state, the faster it turns, the more current should be drawn by the motor. It will be important to find a gearing so that the motor draws appropriate current from the ESC at a given speed. At full speed, (8440 rpm at 50.4V) the motor should have a continuous current draw of about 50 amps to reach it’s intended power limit of around 2.5kW. (50.4V x 50A) Also, given the motor’s KV rating of 168 rpm/V, we can solve for shaft torque at a specified current, because torque constant Kt is simply the inverse of KV.

$$({168\;rev\over min\cdot V}\times{2\pi\;rad\over rev}\times{min\over 60s})^{-1} = 5.684\times 10^{-2}\;{V\over rad/s}$$

$$[N = {kg\cdot m\over sec^{2}}\;\;\;\;\; and\;\;\;\;\;\; V =  {kg\cdot m^{2}\over A\cdot sec^{3}} \\
{N\cdot m\over A} = {kg\cdot m^{2}\over A\cdot sec^{2}} = {V\over rad/s}$$

$$Kt = 5.684\times 10^{-2}\;Nm/A$$

At 50A this results in 2.84 Nm. This figure can be checked by calculating power output:
$$P = \tau \times \omega \\ P = 2.84\;Nm \times {8440\;rev\over min}\times{2\pi\;rad\over rev}\times{min\over 60s}\\ P = 2.5\;kW$$

## Outboard Build

The new outboard more closely resembles a traditional outboard engine with the motor above water level, connected to the propeller through a vertical driveshaft and a 90* bevel gear set. This allows me to have a 2:1 gear reduction through the bevel gears and also keep the motor out of the water. Unfortunately I lose water cooling, but it gives me the piece of mind of a dry motor that won’t get banged up by rocks or other stuff in the water. Most of the components are  built out of 6061 aluminum. I’m lucky to have access to a manual mill and lathe; without it this project would have been pretty much impossible. The parts in black are 3D printed from PLA. Apparently PLA can break down in water due to its biodegradable nature, but I haven’t had any issues. The lower drivetrain is sealed from water and features a stuffing box filled with axle grease at the prop shaft output. This has kept most of the water out, but I believe I need to reseal some of the screw holes to make it 100% watertight. Radial bearings are used throughout the driveline and there is a thrust bearing inside the back endcap which transmits the thrust force of the prop shaft to the rest of the outboard. 

Steering duties are taken care of by a micro servo and the grey 3D printed gear set you see. Eventually it might be nice to have a 360* servo, but this introduces problems with determining the exact angle of the outboard because you lose position feedback. For now +/- 45* of throw is sufficient.

I liked the ability to flip the entire outboard assembly up in the previous e-kayak build, so I carried it over to this one. However, gone is the janky cabinet door hinge, replaced by a solid block of 6061 that holds a steel pivot pin, threaded on both ends. Carbon fiber plates are used to hold the outboard assembly to the mount. This setup has reduced play to being basically non-existent. It will be interesting to see how it copes when the boat is turning and the direction of thrust force is not perpendicular to the pivot pin, because this will cause some nasty twisting moments in the assembly.

Moving upwards, the two cables attached just below the motor serve to counter the prop’s thrust moment. Because they are about a quarter of the distance from the pivot point as the prop, the tension on the cables will be about 4 times the thrust force. Holding them in place is another block of aluminum with through-holes and two 8-32 screws on either side which clamp the cables to the retaining block. Originally, M3 screws were used but they couldn’t be tightened enough to prevent the cable from slipping under tension. There is a convenient drain plug hole which allows a nut and washer to be put inside the kayak and tighten the retaining piece directly against the hull. The mounting plate can be made from a thinner material because it doesn’t have to deal with the bending moment of the prop. Still, I think I will redesign the cable retaining block and pivot pin block to be one piece, with high sidewalls joining the gap that exists where the tension cables exit. The current design works for longitudinal thrust forces, but doesn’t accommodate lateral ones very well. (eg when the kayak is turning).

Lastly, the motor is secured with M4 screws which go through the entire length of the collet. I was super lucky that the motor diameter happens to match the 1.5” diameter of the collet, and that the mounting hole locations of the motor match the center of the collet sidewall, giving it a clean appearance. A small hole was drilled about a half inch below the motor, allowing me to stick an allen key in and tighten the drive shaft setscrew. Overall I’m incredibly happy with how the hardware came together and can’t wait to test it on the water!